import streamlit as st
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

# -----------------------------
# í˜ì´ì§€ ì„¤ì •
# -----------------------------
st.set_page_config(layout="wide")
st.title("ğŸ§  ì„¤ë“Â·ë§ê° ì¬ìœ ì… SIR ì •ë³´ í™•ì‚° ëª¨ë¸")

st.markdown("""
ì´ ëª¨ë¸ì€ **ì •ë³´ì˜ ì‹ ë¢°ë„(ì„¤ë“ ê³„ìˆ˜ Î¸)** ì™€  
**ë§ê° í›„ ì¬ìœ ì…ë¥ (Ï)** ì„ ê³ ë ¤í•œ í™•ì¥ SIR ëª¨ë¸ì…ë‹ˆë‹¤.
""")

# -----------------------------
# ì‚¬ìš©ì ì…ë ¥
# -----------------------------
st.sidebar.header("âš™ï¸ ëª¨ë¸ íŒŒë¼ë¯¸í„°")

beta = st.sidebar.slider("ê¸°ë³¸ í™•ì‚°ë¥  Î²", 0.05, 1.0, 0.3)
gamma = st.sidebar.slider("ë§ê°ë¥  Î³", 0.05, 1.0, 0.2)
theta = st.sidebar.slider("ì„¤ë“ ê³„ìˆ˜ Î¸ (ì •ë³´ ì‹ ë¢°ë„)", 0.1, 2.0, 1.0)
rho = st.sidebar.slider("ì¬ìœ ì…ë¥  Ï (R â†’ S)", 0.0, 0.5, 0.05)

days = st.sidebar.slider("ì‹œë®¬ë ˆì´ì…˜ ê¸°ê°„ (ì¼)", 30, 365, 120)

# -----------------------------
# ì´ˆê¸°ê°’
# -----------------------------
S0 = 0.95
I0 = 0.05
R0 = 0.0

dt = 0.1
t = np.arange(0, days, dt)

S = np.zeros(len(t))
I = np.zeros(len(t))
R = np.zeros(len(t))

S[0], I[0], R[0] = S0, I0, R0

# -----------------------------
# ìˆ˜ì¹˜ í•´ì„ (Euler)
# -----------------------------
for i in range(1, len(t)):
    dS = -beta * theta * S[i-1] * I[i-1] + rho * R[i-1]
    dI = beta * theta * S[i-1] * I[i-1] - gamma * I[i-1]
    dR = gamma * I[i-1] - rho * R[i-1]

    S[i] = S[i-1] + dS * dt
    I[i] = I[i-1] + dI * dt
    R[i] = R[i-1] + dR * dt

# -----------------------------
# ê²°ê³¼ ì‹œê°í™”
# -----------------------------
df = pd.DataFrame({
    "Time": t,
    "Susceptible (S)": S,
    "Infected (I)": I,
    "Recovered (R)": R
}).set_index("Time")

st.subheader("ğŸ“ˆ ì •ë³´ í™•ì‚° ë™ì—­í•™")

st.line_chart(df)

# -----------------------------
# í•µì‹¬ ì§€í‘œ
# -----------------------------
st.subheader("ğŸ” í•µì‹¬ ì§€í‘œ ìš”ì•½")

col1, col2, col3 = st.columns(3)

col1.metric("ìµœëŒ€ ì •ë³´ í™•ì‚° ë¹„ìœ¨ (I max)", f"{I.max():.2f}")
col2.metric("í™•ì‚° ë„ë‹¬ ì‹œì  (ì¼)", f"{t[I.argmax()]:.1f}")
col3.metric("ì¥ê¸° ì”ì¡´ ìˆ˜ìš©ì (R)", f"{R[-1]:.2f}")

# -----------------------------
# í•´ì„ ê°€ì´ë“œ
# -----------------------------
st.subheader("ğŸ§  í•´ì„ ê°€ì´ë“œ")

st.markdown("""
- **Î¸ê°€ í´ìˆ˜ë¡**: ì •ë³´ëŠ” ì‚¬ì‹¤ ì—¬ë¶€ì™€ ë¬´ê´€í•˜ê²Œ *ë¯¿ì„ ë§Œí•´ ë³´ì¼ìˆ˜ë¡* í­ë°œ
- **Ïê°€ 0ì´ ì•„ë‹ ë•Œ**: ì •ë³´ëŠ” ì™„ì „íˆ ì‚¬ë¼ì§€ì§€ ì•Šê³  **ì‚¬íšŒì— ì”ë¥˜**
- ì´ êµ¬ì¡°ëŠ”  
  - ê°€ì§œë‰´ìŠ¤  
  - ë°ˆ  
  - ìœ í–‰ì–´  
  - ì •ì¹˜Â·ì˜í•™ ì •ë³´  
  ì— ëª¨ë‘ ì ìš© ê°€ëŠ¥
""")
